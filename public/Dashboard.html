<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kitchen Dashboard</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #fafafa; }
    h1 { color: #333; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; }
    th { background-color: #f4f4f4; }
    select { padding: 5px; border-radius: 4px; }
    td pre { margin: 0; font-size: 0.9rem; line-height: 1.4; }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>

  <h1>ğŸ”¥ Live Kitchen Dashboard</h1>

  <table>
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Customer</th>
        <th>Items</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="order-table-body"></tbody>
  </table>

  <script>
    // âœ… Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAkwiKjPYsv4LlRQLTxH6kj15xlCnvoXKA",
      authDomain: "testmenu-4ed51.firebaseapp.com",
      projectId: "testmenu-4ed51",
      storageBucket: "testmenu-4ed51.appspot.com",
      messagingSenderId: "98263305480",
      appId: "1:98263305480:web:024158941cb5f53225f0bd"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const orderTableBody = document.getElementById('order-table-body');

    const statusOptions = [
      "Confirmed", 
      "Preparing", 
      "Ready to Serve", 
      "Serve to Table", 
      "Clear Table"
    ];

    // ğŸ” Real-time listener
    db.collection("orders")
      .orderBy("timestamp", "desc")
      .onSnapshot(snapshot => {
        orderTableBody.innerHTML = '';
        snapshot.forEach(doc => {
          const order = doc.data();
          const row = document.createElement('tr');

          const itemsFormatted = order.items.map(item =>
            `${item.name} x${item.qty} = â‚¹${item.qty * item.price}`).join('\n');

          const currentStatus = order.status || "Confirmed";

          const statusDropdown = `
            <select onchange="updateStatus('${doc.id}', this.value)">
              ${statusOptions.map(opt => `
                <option value="${opt}" ${opt === currentStatus ? 'selected' : ''}>${opt}</option>
              `).join('')}
            </select>`;

          row.innerHTML = `
            <td>${doc.id}</td>
            <td>
              <strong>${order.custName}</strong><br>
              ğŸ“± ${order.mobile}<br>
              ğŸª‘ Table: ${order.tableNo}
            </td>
            <td><pre>${itemsFormatted}</pre></td>
            <td>${statusDropdown}</td>
          `;
          orderTableBody.appendChild(row);
        });
      });

    // ğŸ” Status updater
    function updateStatus(orderId, newStatus) {
      db.collection("orders").doc(orderId).update({
        status: newStatus
      }).then(() => {
        console.log(`âœ… Status updated to ${newStatus} for ${orderId}`);
      }).catch(err => {
        console.error("âŒ Failed to update status", err);
        alert("âŒ Could not update status");
      });
    }
  </script>

</body>
</html>
